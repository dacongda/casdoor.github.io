"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[1227],{3905:(e,a,r)=>{r.d(a,{Zo:()=>c,kt:()=>g});var n=r(67294);function t(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function o(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?o(Object(r),!0).forEach((function(a){t(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function i(e,a){if(null==e)return{};var r,n,t=function(e,a){if(null==e)return{};var r,n,t={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],a.indexOf(r)>=0||(t[r]=e[r]);return t}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],a.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var l=n.createContext({}),u=function(e){var a=n.useContext(l),r=a;return e&&(r="function"==typeof e?e(a):s(s({},a),e)),r},c=function(e){var a=u(e.components);return n.createElement(l.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var r=e.components,t=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(r),g=t,m=d["".concat(l,".").concat(g)]||d[g]||p[g]||o;return r?n.createElement(m,s(s({ref:a},c),{},{components:r})):n.createElement(m,s({ref:a},c))}));function g(e,a){var r=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var o=r.length,s=new Array(o);s[0]=d;var i={};for(var l in a)hasOwnProperty.call(a,l)&&(i[l]=a[l]);i.originalType=e,i.mdxType="string"==typeof e?e:t,s[1]=i;for(var u=2;u<o;u++)s[u]=r[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},19129:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var n=r(87462),t=(r(67294),r(3905));const o={title:"Hasura",metaTitle:"Hasura | Tutorial de Autenticaci\xf3n con Hasura",metaDescription:"Aprende c\xf3mo integrar Casdoor con Hasura para asegurar tus aplicaciones usando JWT"},s=void 0,i={unversionedId:"integration/Haskell/Hasura",id:"integration/Haskell/Hasura",title:"Hasura",description:"Antes de la integraci\xf3n, necesitamos desplegar Casdoor localmente.",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/integration/Haskell/Hasura.md",sourceDirName:"integration/Haskell",slug:"/integration/Haskell/Hasura",permalink:"/es/docs/integration/Haskell/Hasura",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/integration/Haskell/Hasura.md",tags:[],version:"current",frontMatter:{title:"Hasura",metaTitle:"Hasura | Tutorial de Autenticaci\xf3n con Hasura",metaDescription:"Aprende c\xf3mo integrar Casdoor con Hasura para asegurar tus aplicaciones usando JWT"},sidebar:"tutorialSidebar",previous:{title:"Haskell",permalink:"/es/docs/category/haskell"},next:{title:"Python",permalink:"/es/docs/category/python"}},l={},u=[{value:"Configurar la aplicaci\xf3n Casdoor",id:"configurar-la-aplicaci\xf3n-casdoor",level:2},{value:"A\xf1ade un usuario en Casdoor",id:"a\xf1ade-un-usuario-en-casdoor",level:2},{value:"Construir la Aplicaci\xf3n Hasura",id:"construir-la-aplicaci\xf3n-hasura",level:2},{value:"Configura Hasura con Casdoor",id:"configura-hasura-con-casdoor",level:2},{value:"Recupera el Token JWT",id:"recupera-el-token-jwt",level:2}],c={toc:u};function p(e){let{components:a,...o}=e;return(0,t.kt)("wrapper",(0,n.Z)({},c,o,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("p",null,"Antes de la integraci\xf3n, necesitamos desplegar Casdoor localmente."),(0,t.kt)("p",null,"Luego podemos implementar r\xe1pidamente una p\xe1gina de inicio de sesi\xf3n basada en Casdoor en nuestra propia aplicaci\xf3n con los siguientes pasos."),(0,t.kt)("h2",{id:"configurar-la-aplicaci\xf3n-casdoor"},"Configurar la aplicaci\xf3n Casdoor"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"Crear o usar una aplicaci\xf3n Casdoor existente."),(0,t.kt)("li",{parentName:"ol"},"A\xf1ade una URL de redirecci\xf3n: ",(0,t.kt)("inlineCode",{parentName:"li"},"http://CASDOOR_HOSTNAME/login")," ",(0,t.kt)("img",{alt:"Configuraci\xf3n de la Aplicaci\xf3n Casdoor",src:r(78479).Z,width:"1767",height:"146"})),(0,t.kt)("li",{parentName:"ol"},"Copia el ID del cliente; lo necesitaremos en los siguientes pasos.")),(0,t.kt)("h2",{id:"a\xf1ade-un-usuario-en-casdoor"},"A\xf1ade un usuario en Casdoor"),(0,t.kt)("p",null,"Ahora que tienes la aplicaci\xf3n, pero no un usuario. Eso significa que necesitas crear un usuario y asignarle un rol."),(0,t.kt)("p",null,'Ve a la p\xe1gina "Usuarios" y haz clic en "A\xf1adir usuario" en la esquina superior derecha. Eso abre una nueva p\xe1gina donde puedes a\xf1adir el nuevo usuario.'),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Imagen mostrando la p\xe1gina de usuarios",src:r(77596).Z,width:"1856",height:"657"})),(0,t.kt)("p",null,"Guarda el usuario despu\xe9s de a\xf1adir un nombre de usuario y a\xf1adir la organizaci\xf3n Hasura (otros detalles son opcionales)."),(0,t.kt)("p",null,'Ahora necesitas configurar una contrase\xf1a para tu usuario, lo cual puedes hacer haciendo clic en "gestionar tu contrase\xf1a".'),(0,t.kt)("p",null,"Elige una contrase\xf1a para tu usuario y conf\xedrmala."),(0,t.kt)("h2",{id:"construir-la-aplicaci\xf3n-hasura"},"Construir la Aplicaci\xf3n Hasura"),(0,t.kt)("p",null,"Inicia Hasura por Docker o Hasura Cloud."),(0,t.kt)("p",null,"Ahora crea una tabla ",(0,t.kt)("inlineCode",{parentName:"p"},"users")," con las siguientes columnas:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"id")," de tipo Texto (Clave Primaria)"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("inlineCode",{parentName:"li"},"username")," de tipo Texto")),(0,t.kt)("p",null,"Refi\xe9rete a la imagen a continuaci\xf3n para referencia."),(0,t.kt)("p",null,(0,t.kt)("img",{parentName:"p",src:"https://graphql-engine-cdn.hasura.io/learn-hasura/assets/graphql-hasura-authentication/keycloak/hasura-create-table.png",alt:"Imagen mostrando c\xf3mo crear una tabla en Hasura"})),(0,t.kt)("p",null,"El siguiente paso es crear un rol ",(0,t.kt)("inlineCode",{parentName:"p"},"user")," para la aplicaci\xf3n. Los usuarios deber\xedan poder ver solo sus registros pero no los registros de otras personas."),(0,t.kt)("p",null,"Configura el rol ",(0,t.kt)("inlineCode",{parentName:"p"},"user")," como se muestra en la imagen a continuaci\xf3n. Para m\xe1s informaci\xf3n, lee acerca de ",(0,t.kt)("a",{parentName:"p",href:"https://hasura.io/docs/latest/graphql/core/auth/authorization/permission-rules/"},"configurar reglas de permisos en Hasura"),"."),(0,t.kt)("p",null,(0,t.kt)("img",{parentName:"p",src:"https://graphql-engine-cdn.hasura.io/learn-hasura/assets/graphql-hasura-authentication/keycloak/hasura-set-permissions.png",alt:"Imagen mostrando c\xf3mo configurar permisos en Hasura"})),(0,t.kt)("p",null,"De esta manera, los usuarios no pueden leer los registros de otras personas. Solo pueden acceder a los suyos."),(0,t.kt)("p",null,"Para prop\xf3sitos de prueba, a\xf1ade un usuario ficticio. Esto es para asegurar que cuando uses el token JWT, solo veas los detalles de tu usuario y no los detalles de otros usuarios."),(0,t.kt)("p",null,(0,t.kt)("img",{parentName:"p",src:"https://graphql-engine-cdn.hasura.io/learn-hasura/assets/graphql-hasura-authentication/keycloak/hasura-dummy-user.png",alt:"Imagen mostrando c\xf3mo a\xf1adir un registro de tabla en Hasura"})),(0,t.kt)("p",null,"Ahora necesitas configurar el ",(0,t.kt)("inlineCode",{parentName:"p"},"JWT_SECRET")," en Hasura."),(0,t.kt)("h2",{id:"configura-hasura-con-casdoor"},"Configura Hasura con Casdoor"),(0,t.kt)("p",null,"En este paso, necesitas a\xf1adir el ",(0,t.kt)("strong",{parentName:"p"},"HASURA_GRAPHQL_JWT_SECRET")," a Hasura."),(0,t.kt)("p",null,"Para hacerlo, ve al docker-compose.yaml de Hasura y luego a\xf1ade el nuevo ",(0,t.kt)("inlineCode",{parentName:"p"},"HASURA_GRAPHQL_JWT_SECRET")," como se muestra a continuaci\xf3n."),(0,t.kt)("p",null,"El ",(0,t.kt)("inlineCode",{parentName:"p"},"HASURA_GRAPHQL_JWT_SECRET")," debe estar en el siguiente formato. Recuerda cambiar ",(0,t.kt)("inlineCode",{parentName:"p"},"<Casdoor endpoint>")," por la URL de tu propio Casdoor (como ",(0,t.kt)("inlineCode",{parentName:"p"},"https://door.casdoor.com"),")"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'HASURA_GRAPHQL_JWT_SECRET: \'{"claims_map": {\n      "x-hasura-allowed-roles": {"path": "$.roles"},\n      "x-hasura-default-role": {"path": "$.roles[0]"},\n      "x-hasura-user-id": {"path": "$.id"}\n    },"jwk_url":"<Casdoor endpoint>/.well-known/jwks"}\'\n')),(0,t.kt)("p",null,"Guarda el cambio y recarga el docker."),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"A\xf1ade la URL del JWT de Clerk a Hasura",src:r(40876).Z,width:"963",height:"242"})),(0,t.kt)("h2",{id:"recupera-el-token-jwt"},"Recupera el Token JWT"),(0,t.kt)("p",null,"Dado que no hay una implementaci\xf3n del cliente, puedes obtener tu token de acceso haciendo una solicitud por la URL a continuaci\xf3n:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-url"},"http://localhost:8000/login/oauth/authorize?client_id=<client ID>&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Flogin&scope=read&state=app-built-in<public certificate>>\n")),(0,t.kt)("p",null,"Cambia ",(0,t.kt)("inlineCode",{parentName:"p"},"client ID")," por el ID que copiaste antes e ingresa el certificado p\xfablico de Casdoor, el cual puedes encontrar en la p\xe1gina de Certificados de Casdoor."),(0,t.kt)("p",null,"Luego ingresa el nombre de usuario y la contrase\xf1a que creaste para Hasura antes."),(0,t.kt)("p",null,'Haz clic en "Iniciar sesi\xf3n"'),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Recupera el Token JWT",src:r(20588).Z,width:"1871",height:"846"})),(0,t.kt)("p",null,"Vuelve a la p\xe1gina Casdoor/Token."),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"P\xe1gina de Token",src:r(16786).Z,width:"1827",height:"793"})),(0,t.kt)("p",null,'Encuentra el Nombre de Usuario que ingresaste antes, luego haz clic en "editar"'),(0,t.kt)("p",null,"Copia el Token de Acceso"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Token de Acceso",src:r(51355).Z,width:"1843",height:"814"})),(0,t.kt)("p",null,"Ahora puedes usar el token de acceso para hacer la solicitud autenticada. Hasura devolvi\xf3 el usuario apropiado en lugar de devolver todos los usuarios de la base de datos."),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Imagen mostrando el token de acceso de Casdoor siendo usado en Hasura",src:r(37884).Z,width:"1819",height:"922"})))}p.isMDXComponent=!0},40876:(e,a,r)=>{r.d(a,{Z:()=>n});const n=r.p+"assets/images/JWT-4529538a012c1b4739a3e8269107278a.png"},51355:(e,a,r)=>{r.d(a,{Z:()=>n});const n=r.p+"assets/images/access-a7d8fb20ba05b1a548f603664c912c9f.png"},78479:(e,a,r)=>{r.d(a,{Z:()=>n});const n=r.p+"assets/images/cas-5af2f28e52ed3cd92f069520979945f5.png"},37884:(e,a,r)=>{r.d(a,{Z:()=>n});const n=r.p+"assets/images/hasura-0ab496d67e2e34ed63dc93407053abe0.png"},20588:(e,a,r)=>{r.d(a,{Z:()=>n});const n=r.p+"assets/images/login-537105fddeaaeff5471ca0cd0c5e2f21.png"},16786:(e,a,r)=>{r.d(a,{Z:()=>n});const n=r.p+"assets/images/tokens-d3624b07df57028c7a6085d18855c0f5.png"},77596:(e,a,r)=>{r.d(a,{Z:()=>n});const n=r.p+"assets/images/user-bd4da280495b507962f00e452754e5a7.png"}}]);