"use strict";(self.webpackChunkcasdoor_website=self.webpackChunkcasdoor_website||[]).push([[1372],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>m});var o=t(67294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,o,n=function(e,a){if(null==e)return{};var t,o,n={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var d=o.createContext({}),s=function(e){var a=o.useContext(d),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},p=function(e){var a=s(e.components);return o.createElement(d.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},u=o.forwardRef((function(e,a){var t=e.components,n=e.mdxType,r=e.originalType,d=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(t),m=n,k=u["".concat(d,".").concat(m)]||u[m]||c[m]||r;return t?o.createElement(k,i(i({ref:a},p),{},{components:t})):o.createElement(k,i({ref:a},p))}));function m(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var r=t.length,i=new Array(r);i[0]=u;var l={};for(var d in a)hasOwnProperty.call(a,d)&&(l[d]=a[d]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var s=2;s<r;s++)i[s]=t[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}u.displayName="MDXCreateElement"},49583:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var o=t(87462),n=(t(67294),t(3905));const r={title:"Next.js",description:"Usando Casdoor em um projeto Next.js",keywords:["nextjs"],authors:["SamYSF"]},i=void 0,l={unversionedId:"how-to-connect/nextjs",id:"how-to-connect/nextjs",title:"Next.js",description:"Usando Casdoor em um projeto Next.js",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/how-to-connect/nextjs.md",sourceDirName:"how-to-connect",slug:"/how-to-connect/nextjs",permalink:"/pt/docs/how-to-connect/nextjs",draft:!1,editUrl:"https://github.com/casdoor/casdoor-website/edit/master/docs/how-to-connect/nextjs.md",tags:[],version:"current",frontMatter:{title:"Next.js",description:"Usando Casdoor em um projeto Next.js",keywords:["nextjs"],authors:["SamYSF"]},sidebar:"tutorialSidebar",previous:{title:"Plugin Casdoor",permalink:"/pt/docs/how-to-connect/plugin"},next:{title:"Nuxt",permalink:"/pt/docs/how-to-connect/nuxt"}},d={},s=[{value:"Passo 1: Implementar o Casdoor",id:"passo-1-implementar-o-casdoor",level:2},{value:"Passo 2: Adicionar Middleware",id:"passo-2-adicionar-middleware",level:2},{value:"Exemplo",id:"exemplo",level:3},{value:"Passo 3: Usar o SDK do Casdoor",id:"passo-3-usar-o-sdk-do-casdoor",level:2},{value:"1.Instalar o SDK",id:"1instalar-o-sdk",level:3},{value:"2.Inicializando o SDK",id:"2inicializando-o-sdk",level:3},{value:"Exemplo",id:"exemplo-1",level:3},{value:"3.Redirecionar para a P\xe1gina de Login",id:"3redirecionar-para-a-p\xe1gina-de-login",level:3},{value:"4.Obter Token e Armazenamento",id:"4obter-token-e-armazenamento",level:3},{value:"Passo 4: Adicionar Fun\xe7\xe3o de Autentica\xe7\xe3o Middleware",id:"passo-4-adicionar-fun\xe7\xe3o-de-autentica\xe7\xe3o-middleware",level:2},{value:"Exemplo",id:"exemplo-2",level:3}],p={toc:s};function c(e){let{components:a,...t}=e;return(0,n.kt)("wrapper",(0,o.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/casdoor/nextjs-auth"},"nextjs-auth")," \xe9 um exemplo de como integrar o casdoor em um projeto next-js. Vamos gui\xe1-lo atrav\xe9s dos passos a seguir."),(0,n.kt)("h2",{id:"passo-1-implementar-o-casdoor"},"Passo 1: Implementar o Casdoor"),(0,n.kt)("p",null,"Primeiramente, o Casdoor deve ser implementado."),(0,n.kt)("p",null,"Voc\xea pode consultar a documenta\xe7\xe3o oficial do Casdoor para a ",(0,n.kt)("a",{parentName:"p",href:"/docs/basic/server-installation"},"Instala\xe7\xe3o do Servidor"),". Por favor, implemente sua inst\xe2ncia do Casdoor em ",(0,n.kt)("strong",{parentName:"p"},"modo de produ\xe7\xe3o"),"."),(0,n.kt)("p",null,"Ap\xf3s uma implementa\xe7\xe3o bem-sucedida, certifique-se do seguinte:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Abra seu navegador favorito e visite ",(0,n.kt)("strong",{parentName:"li"},"http\\://localhost:8000"),". Voc\xea ver\xe1 a p\xe1gina de login do Casdoor."),(0,n.kt)("li",{parentName:"ul"},"Teste a funcionalidade de login inserindo ",(0,n.kt)("inlineCode",{parentName:"li"},"admin")," como nome de usu\xe1rio e ",(0,n.kt)("inlineCode",{parentName:"li"},"123")," como senha.")),(0,n.kt)("p",null,"Depois disso, voc\xea pode implementar rapidamente uma p\xe1gina de login baseada no Casdoor em seu pr\xf3prio aplicativo seguindo os passos abaixo."),(0,n.kt)("h2",{id:"passo-2-adicionar-middleware"},"Passo 2: Adicionar Middleware"),(0,n.kt)("p",null,"Middleware permite que voc\xea execute c\xf3digo antes que uma solicita\xe7\xe3o seja completada. Ent\xe3o, com base na solicita\xe7\xe3o recebida, voc\xea pode modificar a resposta por meio de reescrita, redirecionamento, modifica\xe7\xe3o dos cabe\xe7alhos de solicita\xe7\xe3o ou resposta, ou respondendo diretamente."),(0,n.kt)("p",null,"Use o arquivo ",(0,n.kt)("inlineCode",{parentName:"p"},"middleware.ts")," (ou ",(0,n.kt)("inlineCode",{parentName:"p"},".js"),") na raiz do seu projeto para definir Middleware. Por exemplo, no mesmo n\xedvel que ",(0,n.kt)("inlineCode",{parentName:"p"},"pages")," ou ",(0,n.kt)("inlineCode",{parentName:"p"},"app"),", ou dentro de ",(0,n.kt)("inlineCode",{parentName:"p"},"src")," se aplic\xe1vel."),(0,n.kt)("h3",{id:"exemplo"},"Exemplo"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'//define which paths Middleware will run on\nconst protectedRoutes = ["/profile"];\n\nexport default function middleware(req) {\n  if (protectedRoutes.includes(req.nextUrl.pathname)) {\n    //redirect the incoming request to a different URL\n    return NextResponse.redirect(new URL("/login", req.url));\n  }\n}\n')),(0,n.kt)("p",null,"Veja a documenta\xe7\xe3o oficial do next.js ",(0,n.kt)("a",{parentName:"p",href:"https://nextjs.org/docs/app/building-your-application/routing/middleware"},"middleware")," para mais detalhes."),(0,n.kt)("h2",{id:"passo-3-usar-o-sdk-do-casdoor"},"Passo 3: Usar o SDK do Casdoor"),(0,n.kt)("h3",{id:"1instalar-o-sdk"},"1.Instalar o SDK"),(0,n.kt)("p",null,"Primeiro, instale ",(0,n.kt)("inlineCode",{parentName:"p"},"casdoor-js-sdk")," via NPM ou Yarn:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"npm install casdoor-js-sdk\n")),(0,n.kt)("p",null,"Ou:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add casdoor-js-sdk\n")),(0,n.kt)("h3",{id:"2inicializando-o-sdk"},"2.Inicializando o SDK"),(0,n.kt)("p",null,"Em seguida, inicialize 6 par\xe2metros do tipo string na seguinte ordem:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Nome"),(0,n.kt)("th",{parentName:"tr",align:null},"Obrigat\xf3rio"),(0,n.kt)("th",{parentName:"tr",align:null},"Descri\xe7\xe3o"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"serverUrl"),(0,n.kt)("td",{parentName:"tr",align:null},"Sim"),(0,n.kt)("td",{parentName:"tr",align:null},"URL do Servidor Casdoor, como ",(0,n.kt)("inlineCode",{parentName:"td"},"http://localhost:8000"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"clientId"),(0,n.kt)("td",{parentName:"tr",align:null},"Sim"),(0,n.kt)("td",{parentName:"tr",align:null},"ID do cliente da aplica\xe7\xe3o")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"clientSecret"),(0,n.kt)("td",{parentName:"tr",align:null},"Sim"),(0,n.kt)("td",{parentName:"tr",align:null},"Segredo do cliente da aplica\xe7\xe3o")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"organizationName"),(0,n.kt)("td",{parentName:"tr",align:null},"Sim"),(0,n.kt)("td",{parentName:"tr",align:null},"Organiza\xe7\xe3o da aplica\xe7\xe3o")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"appName"),(0,n.kt)("td",{parentName:"tr",align:null},"Sim"),(0,n.kt)("td",{parentName:"tr",align:null},"Nome da aplica\xe7\xe3o")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"redirectPath"),(0,n.kt)("td",{parentName:"tr",align:null},"Sim"),(0,n.kt)("td",{parentName:"tr",align:null},"URL redirecionada")))),(0,n.kt)("h3",{id:"exemplo-1"},"Exemplo"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'const sdkConfig = {\n  serverUrl: "https://door.casdoor.com",\n  clientId: "294b09fbc17f95daf2fe",\n  clientSecret: "dd8982f7046ccba1bbd7851d5c1ece4e52bf039d",\n  organizationName: "casbin",\n  appName: "app-vue-python-example",\n  redirectPath: "/callback",\n};\n')),(0,n.kt)("admonition",{type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"Substitua os valores de configura\xe7\xe3o pelos da sua pr\xf3pria inst\xe2ncia do Casdoor, especialmente o ",(0,n.kt)("inlineCode",{parentName:"p"},"clientId"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"clientSecret")," e ",(0,n.kt)("inlineCode",{parentName:"p"},"serverUrl"),".")),(0,n.kt)("h3",{id:"3redirecionar-para-a-p\xe1gina-de-login"},"3.Redirecionar para a P\xe1gina de Login"),(0,n.kt)("p",null,"Quando voc\xea precisar autenticar usu\xe1rios que acessam seu aplicativo, voc\xea pode enviar a URL alvo e redirecionar para a p\xe1gina de login fornecida pelo Casdoor."),(0,n.kt)("p",null,"Certifique-se de ter adicionado a URL de retorno (por exemplo, ",(0,n.kt)("strong",{parentName:"p"},"http\\://localhost:8080/callback"),") na configura\xe7\xe3o do aplicativo previamente."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"const CasdoorSDK = new Sdk(sdkConfig);\nCasdoorSDK.signin_redirect();\n")),(0,n.kt)("h3",{id:"4obter-token-e-armazenamento"},"4.Obter Token e Armazenamento"),(0,n.kt)("p",null,"Ap\xf3s a verifica\xe7\xe3o do Casdoor ser aprovada, ele redirecionar\xe1 de volta para o seu aplicativo com token."),(0,n.kt)("p",null,"Voc\xea pode optar por usar cookie para armazenar o token."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'CasdoorSDK.exchangeForAccessToken()\n  .then((res) => {\n    if (res && res.access_token) {\n      //Get Token\n      return CasdoorSDK.getUserInfo(res.access_token);\n    }\n  })\n  .then((res) => {\n    // Storage Token\n    Cookies.set("casdoorUser", JSON.stringify(res));\n  });\n')),(0,n.kt)("p",null,"Voc\xea pode consultar a documenta\xe7\xe3o oficial do Casdoor para ",(0,n.kt)("a",{parentName:"p",href:"https://casdoor.org/docs/how-to-connect/sdk/#how-to-use-casdoor-sdk"},"Como usar o SDK do Casdoor"),"."),(0,n.kt)("h2",{id:"passo-4-adicionar-fun\xe7\xe3o-de-autentica\xe7\xe3o-middleware"},"Passo 4: Adicionar Fun\xe7\xe3o de Autentica\xe7\xe3o Middleware"),(0,n.kt)("p",null,"quando os usu\xe1rios tentam acessar uma rota protegida, a fun\xe7\xe3o de Autentica\xe7\xe3o Middleware verifica a identidade deles. Se o usu\xe1rio n\xe3o estiver autenticado, ele \xe9 redirecionado para uma p\xe1gina de login ou o acesso \xe9 negado."),(0,n.kt)("h3",{id:"exemplo-2"},"Exemplo"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'//protected route\nconst protectedRoutes = ["/profile"];\nconst casdoorUserCookie = req.cookies.get("casdoorUser");\nconst isAuthenticated = casdoorUserCookie ? true : false;\n\n//Authentication Function\nif (!isAuthenticated && protectedRoutes.includes(req.nextUrl.pathname)) {\n  return NextResponse.redirect(new URL("/login", req.url));\n}\n')))}c.isMDXComponent=!0}}]);